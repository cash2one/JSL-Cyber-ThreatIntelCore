import BeautifulSoup as bs
import urllib3
URL = "https://feodotracker.abuse.ch/"


def feodo_tracker_ips(url):
    '''

    :param url:
    :return A list of Lists (20x2) : IP Address, Rank :
    '''
    spamlist = []
    http = urllib3.PoolManager()
    doc = http.request('GET', url).data

    soup = bs.BeautifulSoup(doc)


    soup = soup.findAll('table')[0]

    for row in soup.findAll('tr'):

        aux = row.findAll('td')

        if len(aux) > 1 :
            spam = {}

            spam['palevo_tracker'] = "0"
            spam['feodo_tracker'] = "1"
            spam['spyeye_tracker'] = "0"
            spam['zeus_tracker'] = "0"

            spam['ip_address'] = aux[2].find('a').string
            spam['listing_date'] = aux[0].string
            spam['autonomous_system_number'] = aux[5].string
            #spam['autonomous_system_name'] = aux[6].string
            if (aux[6]) < 1:
                spam['country'] = aux[6].contents[1]



            print spam
            spamlist.append(spam)




    return spamlist


feodo_tracker_ips(URL)